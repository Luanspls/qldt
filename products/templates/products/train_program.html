{% load static %}
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
    <title>Qu·∫£n l√Ω Ch∆∞∆°ng tr√¨nh ƒê√†o t·∫°o</title>
    
    <!-- CSS -->
    <link rel="stylesheet" href="{% static 'css/style_train_program.css' %}">
    
    <!-- External CSS Libraries -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />

    <!-- Preload critical resources -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preload" as="style" href="css/style_train_program.css">
    
    <!-- Favicon ƒë·ªÉ tr√°nh l·ªói 404 -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üìö</text></svg>">
    
    <!-- Inline critical CSS -->
    <style>
        /* Minimal critical CSS for initial render */
        body { margin: 0; padding: 0; }
        .container { padding: 1rem; }
        .loading { display: none; }
    </style>
</head>
<body class="bg-gray-100">
    {% csrf_token %}
    
    <!-- Loading indicator -->
    <div id="loading" class="loading fixed inset-0 bg-white bg-opacity-75 flex items-center justify-center z-50">
        <div class="text-center">
            <div class="spinner mb-4"></div>
            <p class="text-gray-700">ƒêang t·∫£i d·ªØ li·ªáu...</p>
        </div>
    </div>
    
    <div class="container mx-auto px-4 py-8">
        <h1 class="text-3xl font-bold text-center mb-8 text-blue-800">QU·∫¢N L√ù CH∆Ø∆†NG TR√åNH ƒê√ÄO T·∫†O</h1>
            
        <!-- Th√¥ng tin chung -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                <div class="mb-4">
                    <label class="block text-gray-700 font-medium mb-2">Khoa</label>
                    <select id="khoa-dao-tao" class="w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="">-- Ch·ªçn khoa --</option>
                        {% for department in departments %}
                        <option value="{{ department.id }}">{{ department.name }}</option>
                        {% endfor %}
                    </select>
                </div>
                
                <div class="mb-4">
                    <label class="block text-gray-700 font-medium mb-2">T·ªï b·ªô m√¥n</label>
                    <select id="to-bo-mon" class="w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="">-- Ch·ªçn t·ªï b·ªô m√¥n --</option>
                        {% for group in subject_groups %}
                        <option value="{{ group.id }}" data-department="{{ group.department_id }}">{{ group.name }}</option>
                        {% endfor %}
                    </select>
                </div>
                
                <div class="mb-4">
                    <label class="block text-gray-700 font-medium mb-2">Ch∆∞∆°ng tr√¨nh ƒë√†o t·∫°o</label>
                    <select id="chuong-trinh-dao-tao" class="w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="">-- Ch·ªçn ch∆∞∆°ng tr√¨nh --</option>
                        {% for curriculum in curricula %}
                        <option value="{{ curriculum.id }}">{{ curriculum.name }}</option>
                        {% endfor %}
                    </select>
                </div>
                
                <div class="mb-4">
                    <label class="block text-gray-700 font-medium mb-2">Kh√≥a h·ªçc</label>
                    <select id="khoa-hoc" class="w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="">-- Ch·ªçn kh√≥a h·ªçc --</option>
                        {% for course in courses %}
                        <option value="{{ course.id }}" data-curriculum="{{ course.curriculum_id }}">{{ course.name }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>
        </div>
        
        <!-- N√∫t ch·ª©c nƒÉng -->
		<div class="flex flex-wrap justify-between mb-6">
			<div class="flex space-x-2 mb-4">
    			<button id="btn-them" class="bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-md flex items-center">
        			<i class="fas fa-plus mr-2"></i> Th√™m ch∆∞∆°ng tr√¨nh ƒë√†o t·∫°o
    			</button>
    			<button id="btn-them-mon-hoc" class="bg-green-600 hover:bg-green-700 text-white font-medium py-2 px-4 rounded-md flex items-center">
        			<i class="fas fa-book-medical mr-2"></i> Th√™m m√¥n h·ªçc
    			</button>
    			<button id="btn-cap-nhat" class="bg-gray-600 hover:bg-gray-700 text-white font-medium py-2 px-4 rounded-md flex items-center">
        			<i class="fas fa-sync-alt mr-2"></i> C·∫≠p nh·∫≠t
    			</button>
			</div>
    
			<div>
    			<button id="btn-import" class="bg-purple-600 hover:bg-purple-700 text-white font-medium py-2 px-4 rounded-md flex items-center">
        			<i class="fas fa-file-excel mr-2"></i> Import Excel
    			</button>
			</div>
		</div>

        <!-- Modal import Excel -->
        <div id="modal-import" class="modal fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50 hidden">
            <div class="relative top-10 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-1/2 shadow-lg rounded-md bg-white">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-bold text-gray-900">Import t·ª´ Excel</h3>
                    <button id="btn-dong-import" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
                
                <form id="form-import" class="space-y-4" enctype="multipart/form-data">
                    <div>
                        <label class="block text-gray-700 text-sm font-bold mb-2">Ch∆∞∆°ng tr√¨nh ƒë√†o t·∫°o *</label>
                        <select id="import-curriculum" name="curriculum_id" 
                                class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" 
                                required>
                            <option value="">-- Ch·ªçn ch∆∞∆°ng tr√¨nh --</option>
                            {% for curriculum in curricula %}
                            <option value="{{ curriculum.id }}">{{ curriculum.name }} ({{ curriculum.academic_year }})</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div>
                        <label class="block text-gray-700 text-sm font-bold mb-2">Kh√≥a h·ªçc *</label>
                        <select id="import-course" name="course_id" 
                                class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" 
                                required>
                            <option value="">-- Ch·ªçn kh√≥a h·ªçc --</option>
                            {% for course in courses %}
                            <option value="{{ course.id }}">{{ course.name }} ({{ course.code }})</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div>
                        <label class="block text-gray-700 text-sm font-bold mb-2">File Excel *</label>
                        <input type="file" id="excel-file" name="excel_file" accept=".xlsx, .xls" 
                            class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" 
                            required>
                        <p class="text-xs text-gray-500 mt-1">Ch·ªâ ch·∫•p nh·∫≠n file .xlsx ho·∫∑c .xls, t·ªëi ƒëa 10MB</p>
                    </div>

                    <div>
                        <label class="block text-gray-700 text-sm font-bold mb-2">Ch·ªçn sheet</label>
                        <select id="sheet-select" name="sheet_name" 
                                class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="">-- T·ª± ƒë·ªông ch·ªçn sheet ƒë·∫ßu ti√™n --</option>
                            <!-- C√°c option s·∫Ω ƒë∆∞·ª£c th√™m b·∫±ng JavaScript -->
                        </select>
                        <p class="text-xs text-gray-500 mt-1">Ch·ªçn sheet ch·ª©a d·ªØ li·ªáu m√¥n h·ªçc. N·∫øu kh√¥ng ch·ªçn, sheet ƒë·∫ßu ti√™n s·∫Ω ƒë∆∞·ª£c s·ª≠ d·ª•ng.</p>
                    </div>
                    
                    <div class="text-sm text-gray-600">
                        <p>
                            <a href="#" id="btn-download-template" class="text-blue-600 hover:text-blue-800 inline-flex items-center">
                                <i class="fas fa-download mr-2"></i>T·∫£i file m·∫´u
                            </a>
                        </p>
                    </div>
                    
                    <div class="bg-yellow-50 p-4 rounded-md border border-yellow-200">
                        <h4 class="text-sm font-semibold text-yellow-800 mb-2">L∆∞u √Ω khi import:</h4>
                        <ul class="text-sm text-yellow-700 list-disc list-inside space-y-1">
                            <li>File Excel ph·∫£i theo ƒë√∫ng ƒë·ªãnh d·∫°ng m·∫´u</li>
                            <li>C√°c c·ªôt b·∫Øt bu·ªôc: M√£ m√¥n h·ªçc, T√™n h·ªçc ph·∫ßn, S·ªë t√≠n ch·ªâ</li>
                            <li>M√£ m√¥n h·ªçc kh√¥ng ƒë∆∞·ª£c tr√πng trong c√πng ch∆∞∆°ng tr√¨nh</li>
                        </ul>
                    </div>
                </form>
                
                <div class="flex justify-end mt-6 space-x-3">
                    <button id="btn-huy-import" type="button" 
                            class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-medium py-2.5 px-6 rounded-md transition duration-200">
                        <i class="fas fa-times mr-2"></i>H·ªßy
                    </button>
                    <button id="btn-luu-import" type="button" 
                            class="bg-purple-600 hover:bg-purple-700 text-white font-medium py-2.5 px-6 rounded-md transition duration-200">
                        <i class="fas fa-upload mr-2"></i>Import Excel
                    </button>
                </div>
            </div>
        </div>

        <!-- Modal hi·ªÉn th·ªã l·ªói import -->
        <div id="modal-import-errors" class="modal fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50 hidden">
            <div class="relative top-10 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-2/3 shadow-lg rounded-md bg-white">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-bold text-gray-900">Chi ti·∫øt l·ªói khi import</h3>
                    <button id="btn-dong-errors" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
                <div id="import-errors-content" class="max-h-96 overflow-y-auto mb-4 p-4 bg-gray-100 rounded border">
                    <!-- N·ªôi dung l·ªói s·∫Ω ƒë∆∞·ª£c ƒëi·ªÅn ·ªü ƒë√¢y -->
                </div>
                <div class="flex justify-end">
                    <button id="btn-close-errors" 
                            class="bg-blue-500 hover:bg-blue-700 text-white font-medium py-2.5 px-6 rounded-md transition duration-200">
                        <i class="fas fa-check mr-2"></i>ƒê√≥ng
                    </button>
                </div>
            </div>
        </div>

        <!-- B·∫£ng d·ªØ li·ªáu -->
        <div class="bg-white rounded-lg shadow-md overflow-hidden">
            <div class="table-container">
                <table class="min-w-full divide-y divide-gray-200 table-fixed">
                    <thead class="bg-gray-50 sticky top-0" style="z-index: 10;">
                        <tr>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-12">TT</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-20">M√£ m√¥n h·ªçc</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-48">T√™n h·ªçc ph·∫ßn</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-16">S·ªë t√≠n ch·ªâ</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-20">T·ªïng s·ªë gi·ªù</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-16">L√Ω thuy·∫øt</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-16">Th·ª±c h√†nh</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-20">Ki·ªÉm tra</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-20">Thi</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-12">HK1</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-12">HK2</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider wg-12">HK3</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider wg-12">HK4</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-12">HK5</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-12">HK6</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-60">ƒê∆°n v·ªã</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-40">Gi·∫£ng vi√™n</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-40">Kh√≥a h·ªçc</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-20">Thao t√°c</th>
                        </tr>
                    </thead>
                    <tbody id="table-body" class="bg-white divide-y divide-gray-200">
                        {% if mon_hoc_data %}
							<!-- {{ mon_hoc_data|json_script:"mon-hoc-data-json" }} -->
						{% else %}
		                    <tr>
		                        <td colspan="19" class="px-4 py-4 text-center text-gray-500">
		                            Kh√¥ng c√≥ d·ªØ li·ªáu m√¥n h·ªçc
		                        </td>
		                    </tr>
		                {% endif %}
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- Th√¥ng tin t·ªïng k·∫øt -->
        <div class="mt-6 bg-white rounded-lg shadow-md p-4">
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <div class="text-center">
                    <p class="text-gray-600">T·ªïng s·ªë t√≠n ch·ªâ</p>
                    <p id="tong-tin-chi" class="text-xl font-bold text-blue-700">0</p>
                </div>
                <div class="text-center">
                    <p class="text-gray-600">T·ªïng s·ªë gi·ªù</p>
                    <p id="tong-gio" class="text-xl font-bold text-blue-700">0</p>
                </div>
                <div class="text-center">
                    <p class="text-gray-600">T·ª∑ l·ªá l√Ω thuy·∫øt</p>
                    <p id="ty-le-ly-thuyet" class="text-xl font-bold text-blue-700">0%</p>
                </div>
                <div class="text-center">
                    <p class="text-gray-600">T·ª∑ l·ªá th·ª±c h√†nh</p>
                    <p id="ty-le-thuc-hanh" class="text-xl font-bold text-blue-700">0%</p>
                </div>
            </div>
        </div>

        <!-- Qu·∫£n l√Ω l·ªõp h·ªçc v√† ph√¢n c√¥ng gi·∫£ng d·∫°y -->
        <div class="mt-6 text-center">
            <a href="{% url 'teaching_management' %}" 
            class="bg-purple-600 hover:bg-purple-700 text-white font-medium py-3 px-6 rounded-md inline-flex items-center text-lg">
                <i class="fas fa-chalkboard-teacher mr-3"></i> 
                Qu·∫£n l√Ω Ph√¢n c√¥ng Gi·∫£ng d·∫°y
            </a>
        </div>
    </div>

    <!-- Modals (loaded lazily) -->
    <!-- Modal th√™m ch∆∞∆°ng tr√¨nh ƒë√†o t·∫°o -->
	<div id="modal-them-chuong-trinh" class="modal fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50 hidden">
        <div class="relative top-10 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-1/2 shadow-lg rounded-md bg-white">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold text-gray-900">Th√™m ch∆∞∆°ng tr√¨nh ƒë√†o t·∫°o m·ªõi</h3>
                <button type="button" id="btn-dong-chuong-trinh" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <form id="form-them-chuong-trinh" class="space-y-4">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-gray-700 text-sm font-bold mb-2">M√£ ch∆∞∆°ng tr√¨nh *</label>
                        <input type="text" name="code" 
                            class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" 
                            placeholder="Vd: CNTT_2022"
                            required
                            autocomplete="off">
                    </div>
                    <div>
                        <label class="block text-gray-700 text-sm font-bold mb-2">T√™n ch∆∞∆°ng tr√¨nh *</label>
                        <input type="text" name="name" 
                            class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" 
                            placeholder="Vd: Ch∆∞∆°ng tr√¨nh Tin h·ªçc ·ª©ng d·ª•ng"
                            required
                            autocomplete="off">
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-gray-700 text-sm font-bold mb-2">NƒÉm h·ªçc √°p d·ª•ng *</label>
                        <input type="text" name="academic_year" 
                            class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" 
                            placeholder="Vd: 2022 - 2025"
                            required
                            autocomplete="off">
                    </div>
                    <div>
                        <label class="block text-gray-700 text-sm font-bold mb-2">Ng√†nh ƒë√†o t·∫°o *</label>
                        <select name="major_id" 
                                class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" 
                                required>
                            <option value="">-- Ch·ªçn ng√†nh --</option>
                            {% for major in majors %}
                            <option value="{{ major.id }}">{{ major.name }} ({{ major.code }})</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
                
                <div>
                    <label class="block text-gray-700 text-sm font-bold mb-2">M√¥ t·∫£</label>
                    <textarea name="description" 
                            class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" 
                            rows="3"
                            placeholder="Nh·∫≠p m√¥ t·∫£ v·ªÅ ch∆∞∆°ng tr√¨nh ƒë√†o t·∫°o..."
                            autocomplete="off"></textarea>
                </div>
                
                <div class="bg-blue-50 p-4 rounded-md">
                    <h4 class="text-sm font-semibold text-blue-800 mb-2">Th√¥ng tin b·ªï sung:</h4>
                    <p class="text-sm text-blue-700">
                        ‚Ä¢ Ch∆∞∆°ng tr√¨nh s·∫Ω ƒë∆∞·ª£c t·∫°o v·ªõi tr·∫°ng th√°i "B·∫£n nh√°p"<br>
                        ‚Ä¢ B·∫°n c√≥ th·ªÉ import m√¥n h·ªçc sau khi t·∫°o ch∆∞∆°ng tr√¨nh
                    </p>
                </div>
            </form>
            
            <div class="flex justify-end mt-6 space-x-3">
                <button type="button" id="btn-huy-chuong-trinh" 
                        class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-medium py-2.5 px-6 rounded-md transition duration-200">
                    <i class="fas fa-times mr-2"></i>H·ªßy
                </button>
                <button type="button" id="btn-luu-chuong-trinh" 
                        class="bg-blue-600 hover:bg-blue-700 text-white font-medium py-2.5 px-6 rounded-md transition duration-200">
                    <i class="fas fa-save mr-2"></i>L∆∞u ch∆∞∆°ng tr√¨nh
                </button>
            </div>
        </div>
    </div>

    <!-- Modal th√™m m√¥n h·ªçc -->
    <div id="modal-them-mon-hoc" class="modal fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50 hidden">
        <div class="relative top-10 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-2/3 shadow-lg rounded-md bg-white" style="z-index: 1001;">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold text-gray-900">Th√™m m√¥n h·ªçc m·ªõi</h3>
                <button type="button" id="btn-dong-mon-hoc" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <div class="bg-blue-50 p-4 rounded-md mb-4">
                <h4 class="text-sm font-semibold text-blue-800 mb-2">Ch·ªçn t·ª´ m√¥n h·ªçc c√≥ s·∫µn</h4>
                <div class="flex space-x-2 mb-2">
                    <select id="select-existing-subject" class="flex-1">
                        <option value="">-- T√¨m ki·∫øm m√¥n h·ªçc c√≥ s·∫µn --</option>
                        <!-- Options s·∫Ω ƒë∆∞·ª£c ƒëi·ªÅn b·∫±ng JavaScript -->
                    </select>
                    <button type="button" id="btn-use-existing" 
                            class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md whitespace-nowrap">
                        <i class="fas fa-check mr-1"></i> Ch·ªçn
                    </button>
                </div>
                <p class="text-xs text-blue-600">Ch·ªçn m√¥n h·ªçc t·ª´ danh s√°ch c√≥ s·∫µn ƒë·ªÉ t·ª± ƒë·ªông ƒëi·ªÅn th√¥ng tin</p>
            </div>

            <!-- Th√™m ph·∫ßn hi·ªÉn th·ªã th√¥ng tin m√¥n h·ªçc ƒë√£ ch·ªçn -->
            <div id="existing-subject-info" class="bg-green-50 p-3 rounded-md border border-green-200 hidden mb-4">
                <div class="flex justify-between items-center">
                    <div>
                        <h4 class="text-sm font-semibold text-green-800">ƒê√£ ch·ªçn m√¥n h·ªçc c√≥ s·∫µn</h4>
                        <p class="text-sm text-green-700" id="selected-subject-name"></p>
                    </div>
                    <button type="button" id="btn-clear-selection" class="text-red-600 hover:text-red-800">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>

            <form id="form-them-mon-hoc" class="space-y-4">
                <!-- Th√¥ng tin ch∆∞∆°ng tr√¨nh -->
                <div class="bg-blue-50 p-4 rounded-md">
                    <h4 class="text-sm font-semibold text-blue-800 mb-2">Th√¥ng tin ch∆∞∆°ng tr√¨nh ƒë√†o t·∫°o</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-gray-700 text-sm font-bold mb-2">Ch∆∞∆°ng tr√¨nh ƒë√†o t·∫°o *</label>
                            <select id="them-mon-hoc-curriculum" name="curriculum_id" 
                                    class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" 
                                    required>
                                <option value="">-- Ch·ªçn ch∆∞∆°ng tr√¨nh --</option>
                                {% for curriculum in curricula %}
                                <option value="{{ curriculum.id }}">{{ curriculum.name }} ({{ curriculum.academic_year }})</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div>
                            <label class="block text-gray-700 text-sm font-bold mb-2">Kh√≥a h·ªçc *</label>
                            <select id="them-mon-hoc-course" name="course_id" 
                                    class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" 
                                    required>
                                <option value="">-- Ch·ªçn kh√≥a h·ªçc --</option>
                                {% for course in courses %}
                                <option value="{{ course.id }}">{{ course.name }} ({{ course.code }})</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div>
                            <label class="block text-gray-700 text-sm font-bold mb-2">Ng√†nh ƒë√†o t·∫°o</label>
                            <select id="them-mon-hoc-major" name="major_id"
                            		class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        		<option value="">-- Ch·ªçn ng√†nh --</option>
                                {% for major in majors %}
                                <option value="{{ major.id }}">{{ major.name }} ({{ major.code }})</option>
                                {% endfor %}
							</select>
                        </div>
                    </div>
                </div>

                <!-- Th√¥ng tin c∆° b·∫£n m√¥n h·ªçc -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-gray-700 text-sm font-bold mb-2">M√£ m√¥n h·ªçc *</label>
                        <input type="text" name="code" 
                            class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" 
                            placeholder="Vd: MH01"
                            required
                            autocomplete="off">
                    </div>
                    <div>
                        <label class="block text-gray-700 text-sm font-bold mb-2">T√™n m√¥n h·ªçc *</label>
                        <input type="text" name="name" 
                            class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" 
                            placeholder="Vd: Gi√°o d·ª•c ch√≠nh tr·ªã"
                            required
                            autocomplete="off">
                    </div>
                </div>

                <!-- S·ªë t√≠n ch·ªâ v√† gi·ªù -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                    <div>
                        <label class="block text-gray-700 text-sm font-bold mb-2">S·ªë t√≠n ch·ªâ *</label>
                        <input type="number" name="credits" step="0.5" min="0" max="10"
                            class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" 
                            placeholder="0"
                            required
                            autocomplete="off">
                    </div>
                    <div>
                        <label class="block text-gray-700 text-sm font-bold mb-2">T·ªïng s·ªë gi·ªù</label>
                        <input type="number" name="total_hours" min="0"
                            class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" 
                            placeholder="0"
                            autocomplete="off">
                    </div>
                    <div>
                        <label class="block text-gray-700 text-sm font-bold mb-2">L√Ω thuy·∫øt</label>
                        <input type="number" name="theory_hours" min="0"
                            class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" 
                            placeholder="0"
                            autocomplete="off">
                    </div>
                    <div>
                        <label class="block text-gray-700 text-sm font-bold mb-2">Th·ª±c h√†nh</label>
                        <input type="number" name="practice_hours" min="0"
                            class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" 
                            placeholder="0"
                            autocomplete="off">
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                        <label class="block text-gray-700 text-sm font-bold mb-2">Ki·ªÉm tra</label>
                        <input type="number" name="tests_hours" min="0"
                            class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" 
                            placeholder="0"
                            autocomplete="off">
                    </div>
                    <div>
                        <label class="block text-gray-700 text-sm font-bold mb-2">Thi</label>
                        <input type="number" name="exam_hours" min="0"
                            class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" 
                            placeholder="0"
                            autocomplete="off">
                    </div>
                    <div>
                        <label class="block text-gray-700 text-sm font-bold mb-2">Th·ª© t·ª±</label>
                        <input type="number" name="order_number" min="0"
                            class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" 
                            placeholder="0"
                            autocomplete="off">
                    </div>
                </div>

                <!-- Ph√¢n b·ªë h·ªçc k·ª≥ -->
                <div class="bg-yellow-50 p-4 rounded-md border border-yellow-200">
                    <h4 class="text-sm font-semibold text-yellow-800 mb-3">Ph√¢n b·ªë h·ªçc k·ª≥ (s·ªë t√≠n ch·ªâ)</h4>
                    <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4">
                        {% for i in "123456" %}
                        <div>
                            <label class="block text-gray-700 text-sm font-medium mb-1">H·ªçc k·ª≥ {{ i }}</label>
                            <input type="number" name="hk{{ i }}" step="0.5" min="0" max="10"
                                class="w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-center" 
                                placeholder="-"
                                autocomplete="off">
                        </div>
                        {% endfor %}
                    </div>
                </div>

                <!-- Th√¥ng tin b·ªï sung -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-gray-700 text-sm font-bold mb-2">ƒê∆°n v·ªã qu·∫£n l√Ω</label>
                        <select id="them-mon-hoc-department" name="department_id" 
                                class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            <option value="">-- Ch·ªçn ƒë∆°n v·ªã --</option>
                            {% for department in departments %}
                            <option value="{{ department.id }}">{{ department.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div>
                        <label class="block text-gray-700 text-sm font-bold mb-2">Lo·∫°i m√¥n *</label>
                        <select id="them-mon-hoc-subject-type" name="subject_type_id" 
                                class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" 
                                required>
                            <option value="">-- Ch·ªçn lo·∫°i m√¥n --</option>
                            {% for subject_type in subject_types %}
                            <option value="{{ subject_type.id }}">{{ subject_type.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-gray-700 text-sm font-bold mb-2">T·ªï b·ªô m√¥n</label>
                        <select id="them-mon-hoc-subject-group" name="subject_group_id" 
                                class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            <option value="">-- Ch·ªçn t·ªï b·ªô m√¥n --</option>
                            {% for subject_group in subject_groups %}
                            <option value="{{ subject_group.id }}" data-department="{{ subject_group.department_id }}">{{ subject_group.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div>
                        <label class="block text-gray-700 text-sm font-bold mb-2">H·ªçc k·ª≥ m·∫∑c ƒë·ªãnh</label>
                        <select id="them-mon-hoc-semester" name="semester" 
                                class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            <option value="">-- Ch·ªçn h·ªçc k·ª≥ --</option>
                            {% for i in "123456" %}
                            <option value="{{ i }}">H·ªçc k·ª≥ {{ i }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>

                <div>
                    <label class="block text-gray-700 text-sm font-bold mb-2">M√¥ t·∫£ m√¥n h·ªçc</label>
                    <textarea name="description" 
                            class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" 
                            rows="3"
                            placeholder="Nh·∫≠p m√¥ t·∫£ v·ªÅ m√¥n h·ªçc..."
                            autocomplete="off"></textarea>
                </div>

                <div>
                    <label class="block text-gray-700 text-sm font-bold mb-2">ƒêi·ªÅu ki·ªán ti√™n quy·∫øt</label>
                    <textarea name="prerequisites" 
                            class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" 
                            rows="2"
                            placeholder="Nh·∫≠p ƒëi·ªÅu ki·ªán ti√™n quy·∫øt (n·∫øu c√≥)..."
                            autocomplete="off"></textarea>
                </div>

                <div>
                    <label class="block text-gray-700 text-sm font-bold mb-2">Chu·∫©n ƒë·∫ßu ra</label>
                    <textarea name="learning_outcomes" 
                            class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" 
                            rows="2"
                            placeholder="Nh·∫≠p chu·∫©n ƒë·∫ßu ra c·ªßa m√¥n h·ªçc..."
                            autocomplete="off"></textarea>
                </div>

                <!-- Th√¥ng tin m√¥n t·ª± ch·ªçn -->
                <div class="bg-green-50 p-4 rounded-md border border-green-200">
                    <h4 class="text-sm font-semibold text-green-800 mb-3">Th√¥ng tin m√¥n t·ª± ch·ªçn (n·∫øu c√≥)</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="flex items-center">
                            <input type="checkbox" name="is_elective" id="is_elective" 
                                class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                            <label for="is_elective" class="ml-2 block text-sm text-gray-700 font-medium">
                                L√† m√¥n t·ª± ch·ªçn
                            </label>
                        </div>
                        <div>
                            <label class="block text-gray-700 text-sm font-bold mb-2">Nh√≥m m√¥n t·ª± ch·ªçn</label>
                            <input type="text" name="elective_group" 
                                class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" 
                                placeholder="Vd: Nh√≥m 1"
                                autocomplete="off">
                        </div>
                    </div>
                </div>
            </form>
            
            <div class="flex justify-end mt-6 space-x-3">
                <button type="button" id="btn-huy-mon-hoc" 
                        class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-medium py-2.5 px-6 rounded-md transition duration-200">
                    <i class="fas fa-times mr-2"></i>H·ªßy
                </button>
                <button type="button" id="btn-luu-mon-hoc" 
                        class="bg-green-600 hover:bg-green-700 text-white font-medium py-2.5 px-6 rounded-md transition duration-200">
                    <i class="fas fa-save mr-2"></i>L∆∞u m√¥n h·ªçc
                </button>
            </div>
        </div>
    </div>

    <!-- External JS Libraries -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/i18n/vi.js"></script> defer></script>
    
    <!-- D·ªØ li·ªáu t·ª´ Django template -->
    <script>
        // Pass Django template data to JavaScript
        window.appData = {
            departments: {% if departments %}{{ departments|safe }}{% else %}[]{% endif %},
            subject_groups: {% if subject_groups %}{{ subject_groups|safe }}{% else %}[]{% endif %},
            curricula: {% if curricula %}{{ curricula|safe }}{% else %}[]{% endif %},
            courses: {% if courses %}{{ courses|safe }}{% else %}[]{% endif %},
            subject_types: {% if subject_types %}{{ subject_types|safe }}{% else %}[]{% endif %},
            majors: {% if majors %}{{ majors|safe }}{% else %}[]{% endif %},
            mon_hoc_data: {% if mon_hoc_data %}{{ mon_hoc_data|safe }}{% else %}[]{% endif %}
        };
    </script>
    
    <!-- Load main app with low priority -->
    <script src="{% static 'js/ultils_train_program.js' %}"></script>
    <script src="{% static 'js/train_program.js' %}"></script>
    
    <!-- Service worker for offline support -->
    <script>
        // Load non-critical resources after page load
        window.addEventListener('load', function() {
            // Load Tailwind CSS asynchronously
            const tailwindLink = document.createElement('link');
            tailwindLink.rel = 'stylesheet';
            tailwindLink.href = 'https://cdn.tailwindcss.com';
            document.head.appendChild(tailwindLink);
            
            // Hide loading indicator
            document.getElementById('loading').style.display = 'none';
        });
    </script>
</body>
</html>
